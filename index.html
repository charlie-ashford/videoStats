<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Analytics</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900&family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/odometer.js/0.4.8/themes/odometer-theme-default.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/odometer.js/0.4.8/odometer.min.js"></script>
    <script src="https://code.highcharts.com/12.0.2/highcharts.js"></script>
    <link
      rel="icon"
      href="https://api.communitrics.com/youtube/profile?channel=communitrics"
      type="image/png"
    />
    <link
      rel="apple-touch-icon"
      href="https://api.communitrics.com/youtube/profile?channel=communitrics"
    />
    <link rel="canonical" href="https://mbvideostats.communitrics.com/" />
    <meta
      name="description"
      content="See hourly data of any MrBeast video, updated in real-time."
    />
    <meta name="theme-color" content="#d32f2f" />
    <meta property="og:title" content="MrBeast Video Statistics" />
    <meta
      property="og:description"
      content="See hourly data of any MrBeast video, updated in real-time."
    />
    <meta property="og:url" content="https://mbvideostats.communitrics.com" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="MrBeast Video Statistics" />
    <meta
      name="twitter:description"
      content="See hourly data of any MrBeast video, updated in real-time."
    />
    <meta name="twitter:url" content="https://mbvideostats.communitrics.com" />

    <style>
      :root {
        --primary-color: #d32f2f;
        --accent-color: #1976d2;
        --background-color: #f0f2f5;
        --card-background-color: #ffffff;
        --text-color: #333333;
        --muted-text-color: #6c757d;
        --border-color: #dee2e6;
        --hover-background-color: #e9ecef;
        --hover-card-background: #f8f9fa;
        --hover-text-color: #d32f2f;
        --button-hover-color: #ff7043;
        --hover-shadow-color: rgba(0, 0, 0, 0.15);
        --hover-border-color: #d32f2f;
        --active-button-color: #c62828;
        --highlight-border-color: #1976d2;
        --search-bar-background: #ffffff;
        --search-bar-border: #ced4da;
        --search-bar-focus-border: #80bdff;
        --search-bar-placeholder: #adb5bd;
        --search-icon-color: #6c757d;
        --toggle-background: #ffffff;
        --toggle-border: #ced4da;
        --toggle-active-background: var(--accent-color);
        --toggle-active-color: #ffffff;

        --font-family: "Inter", "Poppins", sans-serif;
        --font-size-base: 16px;
        --font-size-lg: 1.25rem;
        --font-size-sm: 0.85rem;
        --font-weight-normal: 400;
        --font-weight-medium: 500;
        --font-weight-bold: 700;
      }

      [data-theme="dark"] {
        --background-color: #121212;
        --card-background-color: #1e1e1e;
        --text-color: #e0e0e0;
        --muted-text-color: #bdbdbd;
        --border-color: #333333;
        --hover-background-color: #333366;
        --hover-card-background: #2c2c2c;
        --hover-text-color: #ffab91;
        --button-hover-color: #ffab91;
        --hover-shadow-color: rgba(255, 255, 255, 0.1);
        --hover-border-color: #ffab91;
        --active-button-color: #ff6f00;
        --highlight-border-color: #ffab91;
        --search-bar-background: #2c2c2c;
        --search-bar-border: #444;
        --search-bar-focus-border: #1976d2;
        --search-bar-placeholder: #6c757d;
        --search-icon-color: #adb5bd;
        --toggle-background: #2c2c2c;
        --toggle-border: #444;
        --toggle-active-background: var(--accent-color);
        --toggle-active-color: #ffffff;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-family);
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        padding: 1.5rem;
        transition: background-color 0.3s, color 0.3s;
      }

      a {
        color: inherit;
        text-decoration: none;
        transition: color 0.3s;
      }

      a:hover {
        color: var(--hover-text-color);
      }

      header {
        width: 100%;
        max-width: 1280px;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 2.5rem;
        padding: 1.5rem 2rem;
        background-color: var(--card-background-color);
        border-radius: 12px;
        box-shadow: 0 4px 20px var(--hover-shadow-color);
        transition: background-color 0.3s, box-shadow 0.3s;
      }

      header h1 {
        font-size: 2.5rem;
        color: var(--primary-color);
        font-weight: var(--font-weight-bold);
        transition: color 0.3s;
      }

      .header-controls {
        display: flex;
        align-items: center;
        gap: 1rem;
        width: 100%;
        max-width: 600px;
        position: relative;
      }

      .search-bar {
        position: relative;
        flex-grow: 1;
      }

      .search-bar input {
        width: 100%;
        padding: 0.75rem 2.5rem 0.75rem 1rem;
        border: 1.5px solid var(--search-bar-border);
        border-radius: 8px;
        background-color: var(--search-bar-background);
        color: var(--text-color);
        font-size: var(--font-size-base);
        transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .search-bar input:focus {
        outline: none;
        border-color: var(--search-bar-focus-border);
        box-shadow: 0 0 0 4px rgba(25, 118, 210, 0.2);
        background-color: var(--search-bar-background);
      }

      .search-bar input::placeholder {
        color: var(--search-bar-placeholder);
      }

      .search-bar .search-icon {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--search-icon-color);
        pointer-events: none;
        font-size: 1.25rem;
        transition: color 0.3s;
      }

      .dropdown-list {
        width: 100%;
        position: absolute;
        top: 100%;
        left: 0;
        background-color: var(--card-background-color);
        border-radius: 8px;
        box-shadow: 0 8px 20px var(--hover-shadow-color);
        max-height: 300px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        flex-direction: column;
        transition: opacity 0.3s, transform 0.3s;
        border: 1px solid var(--border-color);
      }

      .dropdown-list.show {
        display: flex;
        opacity: 1;
        transform: translateY(0);
      }

      .dropdown-list-item {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--border-color);
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .dropdown-list-item:last-child {
        border-bottom: none;
      }

      .dropdown-list-item.bold {
        font-weight: var(--font-weight-bold);
      }

      .dropdown-list-item:hover {
        background-color: var(--hover-background-color);
        color: var(--hover-text-color);
      }

      .theme-toggle,
      .export-button {
        background-color: var(--toggle-background);
        border: 1px solid var(--toggle-border);
        padding: 0.6rem;
        border-radius: 50%;
        cursor: pointer;
        transition: background-color 0.3s, border-color 0.3s, transform 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 48px;
        height: 48px;
        box-shadow: 0 4px 12px var(--hover-shadow-color);
      }

      [data-theme="dark"] .theme-toggle,
      [data-theme="dark"] .export-button {
        background-color: var(--toggle-background);
        border: 1px solid var(--toggle-border);
      }

      .theme-toggle:hover,
      .export-button:hover {
        background-color: var(--button-hover-color);
        box-shadow: 0 6px 18px var(--hover-shadow-color);
      }

      .theme-toggle:active,
      .export-button:active {
        background-color: var(--active-button-color);
        transform: scale(0.95);
      }

      .theme-toggle img,
      .export-button img {
        width: 24px;
        height: 24px;
        transition: filter 0.3s;
      }

      .video-info-card {
        display: flex;
        align-items: center;
        background-color: var(--card-background-color);
        border-radius: 12px;
        padding: 1.5rem;
        margin: -1.5rem auto 2rem auto;
        border: 2px solid var(--highlight-border-color);
        box-shadow: 0 4px 20px var(--hover-shadow-color);
        width: 100%;
        max-width: 1280px;
        transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
      }

      .video-info-card:hover {
        box-shadow: 0 12px 30px var(--hover-shadow-color);
        border-color: var(--hover-border-color);
      }

      .video-thumbnail {
        width: 200px;
        height: auto;
        border-radius: 10px;
        margin-right: 1.5rem;
        box-shadow: 0 4px 8px var(--hover-shadow-color);
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .video-thumbnail:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 16px var(--hover-shadow-color);
      }

      .video-details {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        gap: 0.75rem;
      }

      .video-title {
        font-size: 1.75rem;
        font-weight: var(--font-weight-bold);
        color: var(--text-color);
        line-height: 1.3;
        transition: color 0.3s;
      }

      .video-title a {
        color: var(--text-color);
        transition: color 0.3s;
      }

      .video-title a:hover {
        color: var(--hover-text-color);
      }

      .video-duration,
      .video-upload-date {
        font-size: var(--font-size-base); 
        color: var(--muted-text-color);
      }

      .video-id,
      .last-updated {
        font-size: var(--font-size-sm); 
        color: var(--muted-text-color);
      }

      .stats-grid {
        width: 100%;
        max-width: 1280px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
      }

      .stat-card {
        background-color: var(--card-background-color);
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid var(--highlight-border-color);
        text-align: center;
        transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s,
          background-color 0.3s;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        box-shadow: 0 4px 20px var(--hover-shadow-color);
      }

      .stat-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 12px 30px var(--hover-shadow-color);
        border-color: var(--hover-border-color);
        background-color: var(--hover-card-background);
      }

      .stat-card h3 {
        font-size: 1.3rem;
        color: var(--primary-color);
        font-weight: var(--font-weight-bold);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .stat-card h3 i {
        color: var(--primary-color);
        font-size: 1.6rem;
      }

      .stat-card .odometer {
        font-size: 2rem;
        font-weight: var(--font-weight-bold);
        color: var(--text-color);
        line-height: 1.2;
        transition: color 0.3s;
      }

      .chart-container {
        width: 100%;
        max-width: 1280px;
        background-color: var(--card-background-color);
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid var(--highlight-border-color);
        height: 500px;
        margin: 0 auto 3rem auto;
        box-shadow: 0 4px 20px var(--hover-shadow-color);
        transition: background-color 0.3s, box-shadow 0.3s;
      }

      .daily-stats-table {
        width: 100%;
        max-width: 1280px;
        background-color: var(--card-background-color);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 20px var(--hover-shadow-color);
        margin: 0;
        transition: background-color 0.3s, box-shadow 0.3s;
      }

      .daily-stats-table h3 {
        text-align: center;
        padding: 1.5rem;
        background-color: var(--primary-color);
        color: #ffffff;
        font-size: 1.8rem;
        font-weight: var(--font-weight-bold);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin: 0;
      }

      .table-responsive {
        max-height: 600px;
        overflow-x: auto;
        overflow-y: auto;
      }

      .daily-stats-table table {
        width: 100%;
        border-collapse: collapse;
        text-align: left;
        font-family: var(--font-family);
      }

      .daily-stats-table th,
      .daily-stats-table td {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        font-size: var(--font-size-base);
        color: var(--text-color);
        transition: background-color 0.3s, color 0.3s;
      }

      .daily-stats-table th {
        background-color: var(--accent-color);
        color: #ffffff;
        font-weight: var(--font-weight-bold);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: sticky;
        top: 0;
        z-index: 2;
      }

      .daily-stats-table tr {
        transition: background-color 0.3s, transform 0.3s;
      }

      .daily-stats-table tr:nth-child(even) {
        background-color: var(--hover-card-background);
      }

      .daily-stats-table tr:hover {
        background-color: var(--hover-background-color);
        transform: translateY(0.5px) scale(1.01);
      }

      .daily-stats-table .change {
        font-size: var(--font-size-sm);
        color: var(--muted-text-color);
        margin-left: 0.5rem;
        font-weight: var(--font-weight-medium);
      }

      .daily-stats-table .change.positive {
        color: #28a745;
        font-weight: var(--font-weight-bold);
      }

      .daily-stats-table .change.negative {
        color: #dc3545;
        font-weight: var(--font-weight-bold);
      }

      @media (max-width: 900px) {
        header {
          flex-direction: column;
          align-items: stretch;
          padding: 1.25rem;
          margin-bottom: 2rem;
        }

        header h1 {
          font-size: 2.25rem;
          text-align: center;
          margin-bottom: 1rem;
        }

        .header-controls {
          flex-direction: column;
          align-items: stretch;
          gap: 1rem;
        }

        .search-bar {
          width: 100%;
        }

        .theme-toggle,
        .export-button {
          width: 40px;
          height: 40px;
        }

        .video-info-card {
          flex-direction: column;
          padding: 1.25rem;
          align-items: center;
        }

        .video-thumbnail {
          width: 100%;
          max-width: 300px;
          margin: 0 0 1rem 0;
        }

        .video-title {
          font-size: 1.5rem;
          text-align: center;
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .chart-container {
          height: 400px;
        }

        .daily-stats-table table {
          font-size: 0.95rem;
        }

        .daily-stats-table th,
        .daily-stats-table td {
          padding: 0.75rem 1rem;
        }
      }

      @media (max-width: 600px) {
        .theme-toggle,
        .export-button {
          width: 36px;
          height: 36px;
        }

        .search-bar input {
          padding: 0.6rem 2rem 0.6rem 0.8rem;
          font-size: 0.95rem;
        }

        .profile-image {
          margin-right: 0 !important;
          margin-bottom: 0.75rem;
        }

        header h1 {
          margin-left: 0;
          margin-bottom: 0.5rem;
        }

        .header-controls {
          flex-direction: row;
          justify-content: center;
          gap: 0.75rem;
        }

        .theme-toggle,
        .export-button {
          width: 40px;
          height: 40px;
        }

        .daily-stats-table h3 {
          font-size: 1.4rem;
          padding: 1rem;
        }

        .daily-stats-table th,
        .daily-stats-table td {
          padding: 0.6rem 0.8rem;
          font-size: 0.9rem;
        }

        .daily-stats-table tr:hover {
          transform: scale(1);
        }

        .daily-stats-table .change {
          display: block;
          margin-left: 0;
        }

        header {
          flex-direction: column;
          align-items: center;
          text-align: center;
        }

        .search-bar .search-icon {
          font-size: 1rem;
          right: 0.8rem;
        }

        .video-info-card {
          padding: 1rem;
        }

        .video-title {
          font-size: 1.3rem;
        }

        .stat-card h3 {
          font-size: 1.1rem;
        }

        .stat-card .odometer {
          font-size: 2.2rem;
        }

        #dailyStatsTable h3 {
          font-size: 1.4rem;
          padding: 1rem;
        }

        #dailyStatsTable th,
        #dailyStatsTable td {
          padding: 0.8rem 1rem;
          font-size: 0.95rem;
        }
      }
    </style>
  </head>

  <body>
    <header>
      <h1>Video Analytics</h1>
      <div class="header-controls">
        <div class="search-bar">
          <input
            type="text"
            id="searchInput"
            placeholder="Search and select a video or channel..."
            autocomplete="off"
            autocorrect="off"
          />
          <div class="search-icon">
            <i class="fas fa-search"></i>
          </div>
          <div class="dropdown-list" id="dropdownList" role="listbox"></div>
        </div>
        <button class="theme-toggle" id="themeToggle" role="button">
          <img
            src="https://img.icons8.com/material-outlined/24/ffffff/contrast.png"
            alt="Toggle Dark Mode Icon"
            id="themeIcon"
          />
        </button>
        <button class="export-button" id="exportButton" role="button">
          <img
            src="https://img.icons8.com/material-outlined/24/ffffff/download.png"
            alt="Export Data Icon"
            id="exportIcon"
          />
        </button>
      </div>
    </header>

    <div id="videoInfoCard" class="video-info-card" style="display: none">
      <img
        id="videoThumbnail"
        class="video-thumbnail"
        src=""
        alt="Video Thumbnail"
      />
      <div class="video-details">
        <h2 id="videoTitle" class="video-title">
          <a id="videoLink" href="#" target="_blank">Video Title</a>
        </h2>
        <p id="uploadDate" class="video-upload-date">Uploaded on: YYYY-MM-DD</p>
        <p id="videoDuration" class="video-duration">Duration: 00:00</p>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <h3><i class="fas fa-eye"></i> Views</h3>
        <div id="totalViews" class="odometer">0</div>
      </div>
      <div class="stat-card">
        <h3><i class="fas fa-thumbs-up"></i> Likes</h3>
        <div id="totalLikes" class="odometer">0</div>
      </div>
      <div class="stat-card">
        <h3><i class="fas fa-comments"></i> Comments</h3>
        <div id="totalComments" class="odometer">0</div>
      </div>
      <div class="stat-card" id="uploadCountCard" style="display: none">
        <h3><i class="fas fa-upload"></i> Uploads</h3>
        <div id="totalUploads" class="odometer">0</div>
      </div>
    </div>

    <div class="chart-container">
      <div id="videoChart" style="width: 100%; height: 100%"></div>
    </div>

    <div id="dailyStatsTable" class="daily-stats-table" style="display: none">
      <h3>Daily Statistics</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th>Date (EST)</th>
              <th>Views</th>
              <th>Likes</th>
              <th>Comments</th>
            </tr>
          </thead>
          <tbody id="dailyStatsBody"></tbody>
        </table>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const apiEndpoint = "https://api.communitrics.com/videos/all";
        const combinedEndpoint =
          "https://api.communitrics.com/combined-history";
        const mrbeast2Endpoint =
          "https://api.communitrics.com/combined-history-mb2";
        const mrbeastphilanthropyEndpoint =
          "https://api.communitrics.com/combined-history-mbphilanthropy";
        const mrbeastGamingEndpoint =
          "https://api.communitrics.com/combined-history-mbgaming";
        const mrbeastReactsEndpoint =
          "https://api.communitrics.com/combined-history-mbreacts";
        const cocomelonEndpoint =
          "https://api.communitrics.com/combined-history-cocomelon";
        const ronaldoEndpoint =
          "https://api.communitrics.com/combined-history-ronaldo";
        const searchInput = document.getElementById("searchInput");
        const dropdownList = document.getElementById("dropdownList");
        const exportButton = document.getElementById("exportButton");
        const tableContainer = document.querySelector(".table-responsive");
        let videoChart;
        let allData = {};
        let currentVideoId = "mrbeast";
        let selectedSeriesIndex = 0;

        const storedTheme = localStorage.getItem("theme") || "dark";
        document.body.setAttribute("data-theme", storedTheme);

        const themeToggle = document.getElementById("themeToggle");
        const themeIcon = document.getElementById("themeIcon");
        const exportIcon = document.getElementById("exportIcon");

        function updateIconColors(theme) {
          if (theme === "light") {
            themeIcon.src =
              "https://img.icons8.com/material-outlined/24/000000/contrast.png";
            exportIcon.src =
              "https://img.icons8.com/material-outlined/24/000000/download.png";
          } else {
            themeIcon.src =
              "https://img.icons8.com/material-outlined/24/ffffff/contrast.png";
            exportIcon.src =
              "https://img.icons8.com/material-outlined/24/ffffff/download.png";
          }
        }

        document.body.setAttribute("data-theme", storedTheme);

        updateIconColors(storedTheme);

        themeToggle.addEventListener("click", () => {
          const currentTheme = document.body.getAttribute("data-theme");
          const newTheme = currentTheme === "light" ? "dark" : "light";
          document.body.setAttribute("data-theme", newTheme);
          localStorage.setItem("theme", newTheme);

          updateIconColors(newTheme);
        });

        searchInput.addEventListener("focus", () => {
          dropdownList.classList.add("show");
        });

        searchInput.addEventListener("input", (e) => {
          const searchTerm = e.target.value.toLowerCase();
          document.querySelectorAll(".dropdown-list-item").forEach((item) => {
            const text = item.textContent.toLowerCase();
            item.style.display = text.includes(searchTerm) ? "" : "none";
          });
        });

        document.addEventListener("click", (e) => {
          if (!e.target.closest(".search-bar")) {
            dropdownList.classList.remove("show");
          }
        });

        tableContainer.addEventListener("wheel", function (e) {
          if (tableContainer.scrollHeight > tableContainer.clientHeight) {
            e.preventDefault();
            tableContainer.scrollTop += e.deltaY;
          }
        });

        const combinedOption = document.createElement("div");
        combinedOption.classList.add("dropdown-list-item", "bold");
        combinedOption.innerHTML = `
    <div style="display: flex; align-items: center;">
      <img src="https://api.communitrics.com/youtube/profile?channel=mrbeast" alt="MrBeast" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
      MrBeast
    </div>
  `;
        dropdownList.appendChild(combinedOption);

        combinedOption.addEventListener("click", () => {
          searchInput.value = "MrBeast";
          dropdownList.classList.remove("show");
          fetchCombinedStats(
            combinedEndpoint,
            "https://api.communitrics.com/youtube/profile?channel=mrbeast",
            "combined"
          );
        });

        const mrbeast2Option = document.createElement("div");
        mrbeast2Option.classList.add("dropdown-list-item", "bold");
        mrbeast2Option.innerHTML = `
    <div style="display: flex; align-items: center;">
      <img src="https://api.communitrics.com/youtube/profile?channel=mrbeast2" alt="MrBeast 2" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
      MrBeast 2
    </div>
  `;
        dropdownList.appendChild(mrbeast2Option);

        mrbeast2Option.addEventListener("click", () => {
          searchInput.value = "MrBeast 2";
          dropdownList.classList.remove("show");
          fetchCombinedStats(
            mrbeast2Endpoint,
            "https://api.communitrics.com/youtube/profile?channel=mrbeast2",
            "mb2_combined"
          );
        });

        const mrbeastphilanthropyOption = document.createElement("div");
        mrbeastphilanthropyOption.classList.add("dropdown-list-item", "bold");
        mrbeastphilanthropyOption.innerHTML = `
    <div style="display: flex; align-items: center;">
      <img src="https://api.communitrics.com/youtube/profile?channel=mrbeastphilanthropy" alt="Beast Philanthropy" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
      Beast Philanthropy
    </div>
  `;
        dropdownList.appendChild(mrbeastphilanthropyOption);

        mrbeastphilanthropyOption.addEventListener("click", () => {
          searchInput.value = "Beast Philanthropy";
          dropdownList.classList.remove("show");
          fetchCombinedStats(
            mrbeastphilanthropyEndpoint,
            "https://api.communitrics.com/youtube/profile?channel=mrbeastphilanthropy",
            "mbphilanthropy_combined"
          );
        });

        const mrbeastGamingOption = document.createElement("div");
        mrbeastGamingOption.classList.add("dropdown-list-item", "bold");
        mrbeastGamingOption.innerHTML = `
    <div style="display: flex; align-items: center;">
      <img src="https://api.communitrics.com/youtube/profile?channel=mrbeastgaming" alt="MrBeast Gaming" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
      MrBeast Gaming
    </div>
  `;
        dropdownList.appendChild(mrbeastGamingOption);

        mrbeastGamingOption.addEventListener("click", () => {
          searchInput.value = "MrBeast Gaming";
          dropdownList.classList.remove("show");
          fetchCombinedStats(
            mrbeastGamingEndpoint,
            "https://api.communitrics.com/youtube/profile?channel=mrbeastgaming",
            "mbgaming_combined"
          );
        });

        const mrbeastReactsOption = document.createElement("div");
        mrbeastReactsOption.classList.add("dropdown-list-item", "bold");
        mrbeastReactsOption.innerHTML = `
    <div style="display: flex; align-items: center;">
      <img src="https://api.communitrics.com/youtube/profile?channel=mrbeastreacts" alt="Beast Reacts" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
      Beast Reacts
    </div>
  `;
        dropdownList.appendChild(mrbeastReactsOption);

        mrbeastReactsOption.addEventListener("click", () => {
          searchInput.value = "Beast Reacts";
          dropdownList.classList.remove("show");
          fetchCombinedStats(
            mrbeastReactsEndpoint,
            "https://api.communitrics.com/youtube/profile?channel=mrbeastreacts",
            "mbreacts_combined"
          );
        });

        const cocomelonOption = document.createElement("div");
        cocomelonOption.classList.add("dropdown-list-item", "bold");
        cocomelonOption.innerHTML = `
    <div style="display: flex; align-items: center;">
      <img src="https://api.communitrics.com/youtube/profile?channel=cocomelon" alt="Cocomelon - Nursery Rhymes" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
      Cocomelon - Nursery Rhymes
    </div>
  `;
        dropdownList.appendChild(cocomelonOption);

        cocomelonOption.addEventListener("click", () => {
          searchInput.value = "Cocomelon - Nursery Rhymes";
          dropdownList.classList.remove("show");
          fetchCombinedStats(
            cocomelonEndpoint,
            "https://api.communitrics.com/youtube/profile?channel=cocomelon",
            "cocomelon_combined"
          );
        });

        const ronaldoOption = document.createElement("div");
        ronaldoOption.classList.add("dropdown-list-item", "bold");
        ronaldoOption.innerHTML = `
    <div style="display: flex; align-items: center;">
      <img src="https://api.communitrics.com/youtube/profile?channel=cristiano" alt="UR · Cristiano" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
      UR · Cristiano
    </div>
  `;
        dropdownList.appendChild(ronaldoOption);

        ronaldoOption.addEventListener("click", () => {
          searchInput.value = "UR · Cristiano";
          dropdownList.classList.remove("show");
          fetchCombinedStats(
            ronaldoEndpoint,
            "https://api.communitrics.com/youtube/profile?channel=cristiano",
            "ronaldo_combined"
          );
        });

        const urlParams = new URLSearchParams(window.location.search);
        const videoIdFromUrl = urlParams.get("data");

        fetch(apiEndpoint)
          .then((response) => response.json())
          .then((data) => {
            const videos = data.videos;

            function addCommasToTitle(title) {
              return title.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
            }

            videos.forEach((video) => {
              const item = document.createElement("div");
              item.classList.add("dropdown-list-item");
              item.textContent = addCommasToTitle(video.title);
              item.dataset.videoId = video.videoId;
              dropdownList.appendChild(item);

              item.addEventListener("click", (e) => {
                const selectedVideoId = e.currentTarget.dataset.videoId;
                searchInput.value = e.currentTarget.textContent;
                dropdownList.classList.remove("show");
                fetchVideoStats(selectedVideoId);
              });
            });

            if (videoIdFromUrl === "mrbeast") {
              searchInput.value = "MrBeast";
              fetchCombinedStats(
                combinedEndpoint,
                "https://api.communitrics.com/youtube/profile?channel=mrbeast",
                "combined"
              );
            } else if (videoIdFromUrl === "mrbeast2") {
              searchInput.value = "MrBeast 2";
              fetchCombinedStats(
                mrbeast2Endpoint,
                "https://api.communitrics.com/youtube/profile?channel=mrbeast2",
                "mb2_combined"
              );
            } else if (videoIdFromUrl === "mrbeastgaming") {
              searchInput.value = "MrBeast Gaming";
              fetchCombinedStats(
                mrbeastGamingEndpoint,
                "https://api.communitrics.com/youtube/profile?channel=mrbeastgaming",
                "mbgaming_combined"
              );
            } else if (videoIdFromUrl === "mrbeastreacts") {
              searchInput.value = "Beast Reacts";
              fetchCombinedStats(
                mrbeastReactsEndpoint,
                "https://api.communitrics.com/youtube/profile?channel=mrbeastreacts",
                "mbreacts_combined"
              );
            } else if (videoIdFromUrl === "mrbeastphilanthropy") {
              searchInput.value = "Beast Philanthropy";
              fetchCombinedStats(
                mrbeastphilanthropyEndpoint,
                "https://api.communitrics.com/youtube/profile?channel=mrbeastphilanthropy",
                "mbphilanthropy_combined"
              );
            } else if (videoIdFromUrl === "cocomelon") {
              searchInput.value = "Cocomelon - Nursery Rhymes";
              fetchCombinedStats(
                cocomelonEndpoint,
                "https://api.communitrics.com/youtube/profile?channel=cocomelon",
                "cocomelon_combined"
              );
            } else if (videoIdFromUrl === "ronaldo") {
              searchInput.value = "UR · Cristiano";
              fetchCombinedStats(
                ronaldoEndpoint,
                "https://api.communitrics.com/youtube/profile?channel=cristiano",
                "ronaldo_combined"
              );
            } else if (videoIdFromUrl) {
              const matchingVideo = videos.find(
                (video) => video.videoId === videoIdFromUrl
              );
              if (matchingVideo) {
                searchInput.value = addCommasToTitle(matchingVideo.title);
                fetchVideoStats(matchingVideo.videoId);
              } else {
                console.error(
                  "Video ID from URL not found in the list of videos."
                );
              }
            } else if (videos.length > 0) {
              const mostRecentVideo = videos.sort(
                (a, b) => new Date(b.uploadDate) - new Date(a.uploadDate)
              )[0];
              searchInput.value = mostRecentVideo.title;
              fetchVideoStats(mostRecentVideo.videoId);
            }
          });

        function fetchCombinedStats(endpoint, profileImageUrl, urlPath) {
          currentVideoId = urlPath;
          document.getElementById("videoInfoCard").style.display = "none";
          document.querySelector("header h1").textContent = "Channel Analytics";

          const existingProfileImage = document.querySelector(
            "header img.profile-image"
          );
          if (existingProfileImage) {
            existingProfileImage.remove();
          }

          const combinedProfileImage = document.createElement("img");
          combinedProfileImage.src = profileImageUrl;
          combinedProfileImage.alt = "Profile Image";
          combinedProfileImage.style.width = "60px";
          combinedProfileImage.style.height = "60px";
          combinedProfileImage.style.borderRadius = "50%";
          combinedProfileImage.style.marginRight = "-150px";
          combinedProfileImage.classList.add("profile-image");

          const header = document.querySelector("header");
          header.insertBefore(combinedProfileImage, header.firstChild);

          const newUrl = `${window.location.protocol}//${window.location.host}${window.location.pathname}?video=${urlPath}`;
          window.history.pushState({ path: newUrl }, "", newUrl);

          document.getElementById("uploadCountCard").style.display = "flex";

          fetch(endpoint)
            .then((response) => response.json())
            .then((combinedData) => {
              const timestamps = combinedData.map(
                (entry) => new Date(entry.time)
              );
              const views = combinedData.map((entry) => entry.views);
              const likes = combinedData.map((entry) => entry.likes);
              const comments = combinedData.map((entry) => entry.comments);
              const uploads = combinedData.map((entry) => entry.uploadCount);

              allData = { timestamps, views, likes, comments, uploads };

              drawChart();
              updateStats(
                allData.views,
                allData.likes,
                allData.comments,
                allData.uploads
              );

              const dailyData = processDailyData(combinedData);
              const currentDayData = combinedData[combinedData.length - 1];

              createDailyTable(dailyData, currentDayData);

              document.getElementById("dailyStatsTable").style.display =
                "block";
            });
        }

        function processDailyData(data) {
          const dailyData = [];
          let currentDate = null;
          let closestToMidnight = null;

          data.forEach((entry, index) => {
            const entryDate = new Date(entry.time);

            const entryDateString = entryDate.toLocaleDateString("en-US", {
              month: "short",
              day: "numeric",
              year: "numeric",
              timeZone: "America/New_York",
            });

            const entryEasternTime = new Date(
              entryDate.toLocaleString("en-US", {
                timeZone: "America/New_York",
              })
            );

            const millisecondsFromMidnight =
              entryEasternTime.getHours() * 3600000 +
              entryEasternTime.getMinutes() * 60000 +
              entryEasternTime.getSeconds() * 1000 +
              entryEasternTime.getMilliseconds();

            if (entryDateString !== currentDate) {
              if (closestToMidnight || index === 0) {
                dailyData.push(closestToMidnight || entry);
              }
              currentDate = entryDateString;
              closestToMidnight = entry;
            } else {
              const closestDate = new Date(closestToMidnight.time);
              const closestEasternTime = new Date(
                closestDate.toLocaleString("en-US", {
                  timeZone: "America/New_York",
                })
              );

              const closestMillisecondsFromMidnight =
                closestEasternTime.getHours() * 3600000 +
                closestEasternTime.getMinutes() * 60000 +
                closestEasternTime.getSeconds() * 1000 +
                closestEasternTime.getMilliseconds();

              if (millisecondsFromMidnight < closestMillisecondsFromMidnight) {
                closestToMidnight = entry;
              }
            }
          });

          if (
            closestToMidnight &&
            closestToMidnight !== dailyData[dailyData.length - 1]
          ) {
            dailyData.push(closestToMidnight);
          }

          return dailyData;
        }

        function processDailyDataForVideo(data) {
          const dailyData = [];
          let currentDate = null;
          let closestToMidnight = null;
          let firstEntryOfDay = null;

          data.forEach((entry) => {
            const entryDate = new Date(entry.timestamp);
            const entryDateString = entryDate.toLocaleDateString("en-US", {
              month: "short",
              day: "numeric",
              year: "numeric",
              timeZone: "America/New_York",
            });

            const entryEasternTime = new Date(
              entryDate.toLocaleString("en-US", {
                timeZone: "America/New_York",
              })
            );

            const millisecondsFromMidnight =
              entryEasternTime.getHours() * 3600000 +
              entryEasternTime.getMinutes() * 60000 +
              entryEasternTime.getSeconds() * 1000 +
              entryEasternTime.getMilliseconds();

            if (entryDateString !== currentDate) {
              if (firstEntryOfDay) {
                if (firstEntryOfDay.views < 1000) {
                  dailyData.push(firstEntryOfDay);
                } else if (closestToMidnight) {
                  dailyData.push(closestToMidnight);
                }
              }
              currentDate = entryDateString;
              firstEntryOfDay = entry;
              closestToMidnight = entry;
            } else {
              const closestDate = new Date(closestToMidnight.timestamp);
              const closestEasternTime = new Date(
                closestDate.toLocaleString("en-US", {
                  timeZone: "America/New_York",
                })
              );

              const closestMillisecondsFromMidnight =
                closestEasternTime.getHours() * 3600000 +
                closestEasternTime.getMinutes() * 60000 +
                closestEasternTime.getSeconds() * 1000 +
                closestEasternTime.getMilliseconds();

              if (millisecondsFromMidnight < closestMillisecondsFromMidnight) {
                closestToMidnight = entry;
              }
            }
          });

          if (firstEntryOfDay) {
            if (firstEntryOfDay.views < 1000) {
              dailyData.push(firstEntryOfDay);
            } else if (closestToMidnight) {
              dailyData.push(closestToMidnight);
            }
          }

          return dailyData;
        }

        function createDailyTableForVideo(dailyData, currentDayData) {
          const tableBody = document.getElementById("dailyStatsBody");
          tableBody.innerHTML = "";

          const calculateChange = (current, previous) => {
            const change = current - previous;
            const arrow = change < 0 ? "↓" : "";
            const changeString =
              change >= 0
                ? `+${change.toLocaleString()}`
                : change.toLocaleString();
            return `${changeString} ${arrow}`.trim();
          };

          const determineClass = (currentChange, previousChange) => {
            return currentChange > previousChange ? "positive" : "negative";
          };

          if (currentDayData) {
            const currentRow = document.createElement("tr");
            const currentDate = new Date(currentDayData.timestamp);

            const timeString = currentDate.toLocaleTimeString("en-US", {
              hour: "2-digit",
              minute: "2-digit",
              hour12: false,
              timeZone: "America/New_York",
            });

            const dateString = currentDate.toLocaleDateString("en-US", {
              weekday: "short",
              month: "short",
              day: "numeric",
              year: "numeric",
              timeZone: "America/New_York",
            });

            const previousDayData = dailyData[dailyData.length - 1];
            const viewsChange = calculateChange(
              currentDayData.views,
              previousDayData.views
            );
            const likesChange = calculateChange(
              currentDayData.likes,
              previousDayData.likes
            );
            const commentsChange = calculateChange(
              currentDayData.comments,
              previousDayData.comments
            );

            const viewsClass = determineClass(
              currentDayData.views - previousDayData.views,
              previousDayData.views -
                (dailyData[dailyData.length - 2]?.views || 0)
            );
            const likesClass = determineClass(
              currentDayData.likes - previousDayData.likes,
              previousDayData.likes -
                (dailyData[dailyData.length - 2]?.likes || 0)
            );
            const commentsClass = determineClass(
              currentDayData.comments - previousDayData.comments,
              previousDayData.comments -
                (dailyData[dailyData.length - 2]?.comments || 0)
            );

            currentRow.innerHTML = `
      <td>${dateString}, ${timeString}</td>
      <td>${Math.round(
        currentDayData.views
      ).toLocaleString()} <span class="change ${viewsClass}" data-change="${viewsChange}">(${viewsChange})</span></td>
      <td>${Math.round(
        currentDayData.likes
      ).toLocaleString()} <span class="change ${likesClass}" data-change="${likesChange}">(${likesChange})</span></td>
      <td>${Math.round(
        currentDayData.comments
      ).toLocaleString()} <span class="change ${commentsClass}" data-change="${commentsChange}">(${commentsChange})</span></td>
    `;

            tableBody.insertBefore(currentRow, tableBody.firstChild);
          }

          for (let index = dailyData.length - 1; index >= 0; index--) {
            const entry = dailyData[index];
            const row = document.createElement("tr");
            const date = new Date(entry.timestamp);

            date.setDate(date.getDate() - 1);
            const dateString = date.toLocaleDateString("en-US", {
              weekday: "short",
              month: "short",
              day: "numeric",
              year: "numeric",
              timeZone: "America/New_York",
            });

            const viewsChange =
              index > 0
                ? calculateChange(entry.views, dailyData[index - 1].views)
                : "";
            const likesChange =
              index > 0
                ? calculateChange(entry.likes, dailyData[index - 1].likes)
                : "";
            const commentsChange =
              index > 0
                ? calculateChange(entry.comments, dailyData[index - 1].comments)
                : "";

            const viewsClass =
              index > 1
                ? determineClass(
                    entry.views - dailyData[index - 1].views,
                    dailyData[index - 1].views - dailyData[index - 2].views
                  )
                : "";
            const likesClass =
              index > 1
                ? determineClass(
                    entry.likes - dailyData[index - 1].likes,
                    dailyData[index - 1].likes - dailyData[index - 2].likes
                  )
                : "";
            const commentsClass =
              index > 1
                ? determineClass(
                    entry.comments - dailyData[index - 1].comments,
                    dailyData[index - 1].comments -
                      dailyData[index - 2].comments
                  )
                : "";

            row.innerHTML = `
      <td>${dateString}</td>
      <td>${Math.round(
        entry.views
      ).toLocaleString()} <span class="change ${viewsClass}" data-change="${viewsChange}">(${viewsChange})</span></td>
      <td>${Math.round(
        entry.likes
      ).toLocaleString()} <span class="change ${likesClass}" data-change="${likesChange}">(${likesChange})</span></td>
      <td>${Math.round(
        entry.comments
      ).toLocaleString()} <span class="change ${commentsClass}" data-change="${commentsChange}">(${commentsChange})</span></td>
    `;

            tableBody.appendChild(row);
          }
        }

        function createDailyTable(dailyData, currentDayData) {
          const tableBody = document.getElementById("dailyStatsBody");
          tableBody.innerHTML = "";

          const calculateChange = (current, previous) => {
            const change = current - previous;
            const arrow = change < 0 ? "↓" : "";
            const changeString =
              change >= 0
                ? `+${change.toLocaleString()}`
                : change.toLocaleString();
            return `${changeString} ${arrow}`.trim();
          };

          const determineClass = (currentChange, previousChange) => {
            return currentChange > previousChange ? "positive" : "negative";
          };

          if (currentDayData) {
            const currentRow = document.createElement("tr");
            const currentDate = new Date(currentDayData.time);

            const timeString = currentDate.toLocaleTimeString("en-US", {
              hour: "2-digit",
              minute: "2-digit",
              hour12: false,
              timeZone: "America/New_York",
            });

            const dateString = currentDate.toLocaleDateString("en-US", {
              weekday: "short",
              month: "short",
              day: "numeric",
              year: "numeric",
              timeZone: "America/New_York",
            });

            const previousDayData = dailyData[dailyData.length - 1];
            const viewsChange = calculateChange(
              currentDayData.views,
              previousDayData.views
            );
            const likesChange = calculateChange(
              currentDayData.likes,
              previousDayData.likes
            );
            const commentsChange = calculateChange(
              currentDayData.comments,
              previousDayData.comments
            );

            const viewsClass = determineClass(
              currentDayData.views - previousDayData.views,
              previousDayData.views -
                (dailyData[dailyData.length - 2]?.views || 0)
            );
            const likesClass = determineClass(
              currentDayData.likes - previousDayData.likes,
              previousDayData.likes -
                (dailyData[dailyData.length - 2]?.likes || 0)
            );
            const commentsClass = determineClass(
              currentDayData.comments - previousDayData.comments,
              previousDayData.comments -
                (dailyData[dailyData.length - 2]?.comments || 0)
            );

            currentRow.innerHTML = `
      <td>${dateString}, ${timeString}</td>
      <td>${Math.round(
        currentDayData.views
      ).toLocaleString()} <span class="change ${viewsClass}" data-change="${viewsChange}">(${viewsChange})</span></td>
      <td>${Math.round(
        currentDayData.likes
      ).toLocaleString()} <span class="change ${likesClass}" data-change="${likesChange}">(${likesChange})</span></td>
      <td>${Math.round(
        currentDayData.comments
      ).toLocaleString()} <span class="change ${commentsClass}" data-change="${commentsChange}">(${commentsChange})</span></td>
    `;

            tableBody.insertBefore(currentRow, tableBody.firstChild);
          }

          for (let index = dailyData.length - 1; index >= 0; index--) {
            const entry = dailyData[index];
            const row = document.createElement("tr");
            const date = new Date(entry.time);

            date.setDate(date.getDate() - 1);
            const dateString = date.toLocaleDateString("en-US", {
              weekday: "short",
              month: "short",
              day: "numeric",
              year: "numeric",
              timeZone: "America/New_York",
            });

            const viewsChange =
              index > 0
                ? calculateChange(entry.views, dailyData[index - 1].views)
                : "";
            const likesChange =
              index > 0
                ? calculateChange(entry.likes, dailyData[index - 1].likes)
                : "";
            const commentsChange =
              index > 0
                ? calculateChange(entry.comments, dailyData[index - 1].comments)
                : "";

            const viewsClass =
              index > 1
                ? determineClass(
                    entry.views - dailyData[index - 1].views,
                    dailyData[index - 1].views - dailyData[index - 2].views
                  )
                : "";
            const likesClass =
              index > 1
                ? determineClass(
                    entry.likes - dailyData[index - 1].likes,
                    dailyData[index - 1].likes - dailyData[index - 2].likes
                  )
                : "";
            const commentsClass =
              index > 1
                ? determineClass(
                    entry.comments - dailyData[index - 1].comments,
                    dailyData[index - 1].comments -
                      dailyData[index - 2].comments
                  )
                : "";

            row.innerHTML = `
      <td>${dateString}</td>
      <td>${Math.round(
        entry.views
      ).toLocaleString()} <span class="change ${viewsClass}" data-change="${viewsChange}">(${viewsChange})</span></td>
      <td>${Math.round(
        entry.likes
      ).toLocaleString()} <span class="change ${likesClass}" data-change="${likesChange}">(${likesChange})</span></td>
      <td>${Math.round(
        entry.comments
      ).toLocaleString()} <span class="change ${commentsClass}" data-change="${commentsChange}">(${commentsChange})</span></td>
    `;

            tableBody.appendChild(row);
          }
        }

        function fetchVideoStats(videoId) {
          function addCommasToTitle(title) {
            return title.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
          }

          currentVideoId = videoId;
          const newUrl = `${window.location.protocol}//${window.location.host}${window.location.pathname}?video=${videoId}`;
          window.history.pushState({ path: newUrl }, "", newUrl);

          document.getElementById("uploadCountCard").style.display = "none";
          document.querySelector("header h1").textContent = "Video Analytics";

          if (selectedSeriesIndex === 3) {
            selectedSeriesIndex = 0;
          }

          const existingProfileImage = document.querySelector(
            "header img.profile-image"
          );
          if (existingProfileImage) {
            existingProfileImage.remove();
          }

          const videoStatsEndpoint = `https://api.communitrics.com/videostats/${videoId}`;

          fetch(videoStatsEndpoint)
            .then((response) => response.json())
            .then((video) => {
              const videoInfoCard = document.getElementById("videoInfoCard");
              const thumbnailElement =
                document.getElementById("videoThumbnail");
              const videoLinkElement = document.getElementById("videoLink");
              const uploadDateElement = document.getElementById("uploadDate");
              const durationElement = document.getElementById("videoDuration");

              thumbnailElement.src = video.thumbnail;
              videoLinkElement.href = `https://www.youtube.com/watch?v=${video.videoId}`;
              videoLinkElement.textContent = addCommasToTitle(video.title);

              const uploadDate = new Date(video.uploadTime);
              uploadDateElement.textContent = `Uploaded on: ${uploadDate.toLocaleDateString()} at ${uploadDate.toLocaleTimeString()}`;

              const lastUpdatedDate = new Date(video.lastUpdated);
              const lastUpdatedSpan = document.createElement("span");
              lastUpdatedSpan.classList.add("last-updated");
              lastUpdatedSpan.textContent = ` (Stats last updated: ${lastUpdatedDate.toLocaleDateString()} at ${lastUpdatedDate.toLocaleTimeString()})`;
              uploadDateElement.appendChild(lastUpdatedSpan);

              durationElement.textContent = `Duration: ${video.stats[0].duration}`;
              const videoIdSpan = document.createElement("span");
              videoIdSpan.classList.add("video-id");
              videoIdSpan.textContent = ` (Video ID: ${video.videoId})`;
              durationElement.appendChild(videoIdSpan);

              videoInfoCard.style.display = "flex";
              const filteredStats = video.stats.filter(
                (stat) =>
                  stat.views != null &&
                  stat.views !== 0 &&
                  stat.likes != null &&
                  stat.likes !== 0 &&
                  stat.comments != null &&
                  stat.comments !== 0
              );

              const timestamps = filteredStats.map(
                (stat) => new Date(stat.timestamp)
              );
              const views = filteredStats.map((stat) => Math.round(stat.views));
              const likes = filteredStats.map((stat) => Math.round(stat.likes));
              const comments = filteredStats.map((stat) =>
                Math.round(stat.comments)
              );

              allData = { timestamps, views, likes, comments };
              drawChart();
              updateStats(views, likes, comments);

              const dailyData = processDailyDataForVideo(filteredStats);
              const currentDayData = filteredStats[filteredStats.length - 1];

              createDailyTableForVideo(dailyData, currentDayData);
              document.getElementById("dailyStatsTable").style.display =
                "block";
            });
        }

        function drawChart() {
          const MAX_POINTS = 3000;

          if (
            !allData ||
            !allData.timestamps ||
            allData.timestamps.length === 0
          ) {
            console.error("No data available to draw the chart.");
            return;
          }

          if (videoChart) {
            videoChart.destroy();
          }

          function downsampleData(timestamps, data) {
            const length = timestamps.length;

            function convertToEasternTime(timestamp) {
              const utcDate = new Date(Date.parse(timestamp + "Z"));
              return new Date(
                utcDate.toLocaleString("en-US", {
                  timeZone: "America/New_York",
                })
              ).getTime();
            }

            if (length <= MAX_POINTS) {
              return timestamps.map((t, i) => [
                convertToEasternTime(t),
                data[i],
              ]);
            }

            const step = Math.floor(length / MAX_POINTS);
            const sampledData = [];
            for (let i = 0; i < length; i += step) {
              sampledData.push([convertToEasternTime(timestamps[i]), data[i]]);
            }
            return sampledData;
          }

          function getVisibleDataRange(series, min, max) {
            const visiblePoints = series.data.filter((point) => {
              const x = point[0];
              return x >= min && x <= max;
            });

            if (visiblePoints.length === 0) {
              return { min: series.dataMin, max: series.dataMax };
            }

            const yValues = visiblePoints.map((point) => point[1]);
            const visibleMin = Math.min(...yValues);
            const visibleMax = Math.max(...yValues);
            const padding = (visibleMax - visibleMin) * 0.1;
            return {
              min: visibleMin - padding,
              max: visibleMax + padding,
            };
          }

          function getInitialDataRange(data) {
            const yValues = data.map((point) => point[1]);
            const min = Math.min(...yValues);
            const max = Math.max(...yValues);
            const padding = (max - min) * 0.1;
            return {
              min: min - padding,
              max: max + padding,
            };
          }

          const seriesData = [
            {
              name: "Views",
              data: downsampleData(allData.timestamps, allData.views),
              color: {
                linearGradient: {
                  x1: 0,
                  x2: 0,
                  y1: 0,
                  y2: 1,
                },
                stops: [
                  [0, "#ef4444"],
                  [1, "rgba(239, 68, 68, 0.3)"],
                ],
              },
              visible: selectedSeriesIndex === 0,
              marker: {
                enabled: false,
              },
              lineWidth: 3,
            },
            {
              name: "Likes",
              data: downsampleData(allData.timestamps, allData.likes),
              color: {
                linearGradient: {
                  x1: 0,
                  x2: 0,
                  y1: 0,
                  y2: 1,
                },
                stops: [
                  [0, "#1976d2"],
                  [1, "rgba(25, 118, 210, 0.3)"],
                ],
              },
              visible: selectedSeriesIndex === 1,
              marker: {
                enabled: false,
              },
              lineWidth: 3,
            },
            {
              name: "Comments",
              data: downsampleData(allData.timestamps, allData.comments),
              color: {
                linearGradient: {
                  x1: 0,
                  x2: 0,
                  y1: 0,
                  y2: 1,
                },
                stops: [
                  [0, "#0d9488"],
                  [1, "rgba(13, 148, 136, 0.3)"],
                ],
              },
              visible: selectedSeriesIndex === 2,
              marker: {
                enabled: false,
              },
              lineWidth: 3,
            },
          ];

          if (allData.uploads) {
            seriesData.push({
              name: "Uploads",
              data: downsampleData(allData.timestamps, allData.uploads),
              color: {
                linearGradient: {
                  x1: 0,
                  x2: 0,
                  y1: 0,
                  y2: 1,
                },
                stops: [
                  [0, "#8e44ad"],
                  [1, "rgba(142, 68, 173, 0.3)"],
                ],
              },
              visible: selectedSeriesIndex === 3,
              marker: {
                enabled: false,
              },
              lineWidth: 3,
            });
          }

          if (selectedSeriesIndex >= seriesData.length) {
            selectedSeriesIndex = 0;
          }

          const initialRange = getInitialDataRange(
            seriesData[selectedSeriesIndex].data
          );

          videoChart = Highcharts.chart("videoChart", {
            chart: {
              type: "area",
              backgroundColor: "var(--card-background-color)",
              style: {
                fontFamily: "'Poppins', 'Roboto', sans-serif",
              },
              plotBorderColor: "var(--border-color)",
              zoomType: "x",
              panning: true,
              panKey: "shift",
              events: {
                load: function () {
                  const activeSeries = this.series[selectedSeriesIndex];
                  const range = getInitialDataRange(activeSeries.data);
                  this.yAxis[0].setExtremes(range.min, range.max);
                },
              },
              resetZoomButton: {
                position: {
                  align: "right",
                  x: -10,
                  y: 10,
                  verticalAlign: "top",
                },
                theme: {
                  fill: "#3b82f6",
                  stroke: "#2563eb",
                  strokeWidth: 1,
                  r: 4,
                  states: {
                    hover: {
                      fill: "#2563eb",
                      stroke: "#1d4ed8",
                      style: {
                        color: "#ffffff",
                      },
                    },
                  },
                  style: {
                    color: "#ffffff",
                    fontWeight: "500",
                    fontSize: "13px",
                    fontFamily: "'Poppins', 'Roboto', sans-serif",
                    textTransform: "uppercase",
                    padding: "8px 12px",
                  },
                  zIndex: 20,
                },
                relativeTo: "plot",
              },
            },
            title: {
              text:
                selectedSeriesIndex === 0
                  ? "Views"
                  : selectedSeriesIndex === 1
                  ? "Likes"
                  : selectedSeriesIndex === 2
                  ? "Comments"
                  : "Uploads",
              style: {
                color: "var(--text-color)",
                fontWeight: "bold",
                fontSize: "20px",
              },
            },
            credits: {
              enabled: false,
            },
            xAxis: {
              title: {
                text: "Time (EST)",
                style: {
                  color: "var(--text-color)",
                  fontSize: "14px",
                },
              },
              type: "datetime",
              labels: {
                formatter: function () {
                  return Highcharts.dateFormat("%Y-%m-%d<br>%H:%M", this.value);
                },
                style: {
                  color: "var(--text-color)",
                  fontSize: "12px",
                },
              },
              gridLineColor: "var(--border-color)",
              gridLineWidth: 1,
              tickPositioner: function () {
                const positions = [];
                const min = this.min || this.dataMin;
                const max = this.max || this.dataMax;
                const range = max - min;

                const isMobile = this.chart.chartWidth <= 600;
                const maxPoints = isMobile ? 6 : 10;

                let roundingInterval;
                if (range <= 3600000) {
                  roundingInterval = 5 * 60 * 1000;
                } else if (range <= 86400000) {
                  roundingInterval = 30 * 60 * 1000;
                } else if (range <= 604800000) {
                  roundingInterval = 4 * 3600 * 1000;
                } else {
                  roundingInterval = 24 * 3600 * 1000;
                }

                const interval = range / (maxPoints - 1);

                for (let i = 0; i < maxPoints; i++) {
                  const rawPosition = min + i * interval;
                  const roundedPosition =
                    Math.round(rawPosition / roundingInterval) *
                    roundingInterval;
                  positions.push(roundedPosition);
                }

                return positions;
              },
              events: {
                afterSetExtremes: function (e) {
                  if (this.chart) {
                    const activeSeries = this.chart.series[selectedSeriesIndex];
                    const range = getVisibleDataRange(
                      activeSeries,
                      e.min || this.dataMin,
                      e.max || this.dataMax
                    );

                    this.chart.yAxis[0].setExtremes(
                      range.min,
                      range.max,
                      true,
                      {
                        duration: 500,
                        easing: "easeOutCubic",
                      }
                    );
                  }
                },
              },
            },
            yAxis: {
              title: {
                text: "Count",
                style: {
                  color: "var(--text-color)",
                  fontSize: "14px",
                },
              },
              labels: {
                style: {
                  color: "var(--text-color)",
                  fontSize: "12px",
                },
              },
              gridLineColor: "var(--border-color)",
              gridLineWidth: 1,
              startOnTick: false,
              endOnTick: false,
              tickAmount: 8,
              softThreshold: true,
              minPadding: 0.1,
              maxPadding: 0.1,
              min: initialRange.min,
              max: initialRange.max,
              events: {
                afterSetExtremes: function (e) {
                  if (!e.userMin && !e.userMax) {
                    const activeSeries = this.chart.series[selectedSeriesIndex];
                    const range = getVisibleDataRange(
                      activeSeries,
                      this.chart.xAxis[0].min,
                      this.chart.xAxis[0].max
                    );
                    if (range.min !== range.max) {
                      this.update(
                        {
                          min: range.min,
                          max: range.max,
                        },
                        false
                      );
                    }
                  }
                },
              },
            },
            series: seriesData,
            legend: {
              enabled: false,
            },
            tooltip: {
              backgroundColor: "var(--card-background-color)",
              borderColor: "var(--border-color)",
              style: {
                color: "var(--text-color)",
                fontSize: "14px",
              },
              formatter: function () {
                let formattedDate = Highcharts.dateFormat("%Y-%m-%d", this.x);
                let formattedTime =
                  Highcharts.dateFormat("%H:%M", this.x) + ":00";

                let tooltipText = `<b>${formattedDate} ${formattedTime}</b><br>`;

                this.points.forEach((point) => {
                  let label = point.series.name;
                  tooltipText += `${label}: ${point.y.toLocaleString()}<br>`;
                });

                return tooltipText;
              },
              shared: true,
              useHTML: true,
              borderRadius: 10,
              shadow: true,
            },
            plotOptions: {
              series: {
                animaton: false,
                marker: {
                  enabled: false,
                  states: {
                    hover: {
                      enabled: true,
                      radius: 4,
                    },
                  },
                },
                events: {
                  hide: function () {
                    updateSelectedSeriesIndex();
                  },
                  show: function () {
                    updateSelectedSeriesIndex();
                  },
                },
                states: {
                  hover: {
                    lineWidthPlus: 0,
                  },
                },
              },
            },
            boost: {
              enabled: true,
              useGPUTranslations: true,
              usePreallocated: true,
            },
            responsive: {
              rules: [
                {
                  condition: {
                    maxWidth: 600,
                  },
                },
              ],
            },
            rangeSelector: {
              enabled: false,
            },
            navigator: {
              enabled: false,
            },
            scrollbar: {
              enabled: false,
            },
            resetZoomButton: {
              theme: {
                fill: "var(--card-background-color)",
                stroke: "var(--border-color)",
                style: {
                  color: "var(--text-color)",
                },
                states: {
                  hover: {
                    fill: "var(--border-color)",
                    style: {
                      color: "var(--card-background-color)",
                    },
                  },
                },
                r: 4,
              },
              position: {
                align: "right",
                x: -10,
                y: 10,
              },
            },
          });
        }

        function updateStats(views, likes, comments, uploads) {
          const totalViews = views[views.length - 1] || 0;
          const totalLikes = likes[likes.length - 1] || 0;
          const totalComments = comments[comments.length - 1] || 0;

          const viewsElement = document.getElementById("totalViews");
          const likesElement = document.getElementById("totalLikes");
          const commentsElement = document.getElementById("totalComments");

          new Odometer({
            el: viewsElement,
            value: totalViews,
          }).update(totalViews);

          new Odometer({
            el: likesElement,
            value: totalLikes,
          }).update(totalLikes);

          new Odometer({
            el: commentsElement,
            value: totalComments,
          }).update(totalComments);

          if (uploads) {
            const totalUploads = uploads[uploads.length - 1] || 0;
            const uploadsElement = document.getElementById("totalUploads");

            new Odometer({
              el: uploadsElement,
              value: totalUploads,
            }).update(totalUploads);
          }
        }

        function updateSelectedSeriesIndex() {
          selectedSeriesIndex = videoChart.series.findIndex(
            (series) => series.visible
          );
        }

        function showOnlySelectedSeries(index) {
          selectedSeriesIndex = index;
          drawChart();
        }

        document.querySelectorAll(".stat-card").forEach((card, index) => {
          card.addEventListener("click", () => {
            selectedSeriesIndex = index;
            drawChart();
          });
        });

        exportButton.addEventListener("click", () => {
          if (!allData || !allData.timestamps) {
            console.error("No data available to export.");
            return;
          }

          let timestamps = allData.timestamps.map((t, i) => ({
            date: new Date(t),
            views: Math.round(allData.views[i]),
            likes: Math.round(allData.likes[i]),
            comments: Math.round(allData.comments[i]),
          }));

          timestamps.sort((a, b) => a.date - b.date);

          let start = new Date(timestamps[0].date);
          start.setMinutes(0, 0, 0);
          let end = new Date(timestamps[timestamps.length - 1].date);
          end.setMinutes(0, 0, 0);

          let fullRange = [];
          let currentTime = new Date(start);

          while (currentTime <= end) {
            fullRange.push(new Date(currentTime)); 
            currentTime.setHours(currentTime.getHours() + 1);
          }

          let dataMap = new Map();
          timestamps.forEach((entry) => {
            let hourKey = entry.date.toISOString().slice(0, 13); 
            dataMap.set(hourKey, entry);
          });

          let csvContent = "data:text/csv;charset=utf-8,Timestamp,Views,Likes,Comments\n";

          fullRange.forEach((time) => {
            let hourKey = time.toISOString().slice(0, 13);
            let entry = dataMap.get(hourKey);
            
            if (entry) {
              csvContent += `${time.toISOString()},${entry.views},${entry.likes},${entry.comments}\n`;
            } else {
              csvContent += `${time.toISOString()},,,\n`; 
            }
          });

          const encodedUri = encodeURI(csvContent);
          const link = document.createElement("a");
          link.setAttribute("href", encodedUri);
          link.setAttribute("download", `${currentVideoId}.csv`);
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        });
      });
    </script>
  </body>
</html>
